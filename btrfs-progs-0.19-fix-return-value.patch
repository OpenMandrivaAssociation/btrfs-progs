--- btrfs-progs-0.19/btrfsctl.c.orig	2010-10-06 15:53:38.000000000 +0200
+++ btrfs-progs-0.19/btrfsctl.c	2011-07-13 14:53:48.986281003 +0200
@@ -259,9 +259,7 @@ int main(int ac, char **av)
 		printf("ioctl failed with error %d\n", ret);
 	}
 	printf("%s\n", BTRFS_BUILD_VERSION);
-	if (ret)
-		exit(1);
 
-	return 0;
+	return ret ? 1 : 0;
 }
 
